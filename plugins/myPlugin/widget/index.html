<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Crude cache busting -->
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />

	<!-- Load helper.css to use our helper classes.
	<link href="../../../../styles/helper.css" rel="stylesheet">
	-->
	
	<!-- JS -->
	<script src="../../../scripts/buildfire.js"></script>
	<script src="../../../scripts/buildfire/services/notifications/localNotifications.js"></script>

 	<!--
    <script src="../../../../scripts/angular/angular.min.js"></script>
    <script src="../../../../scripts/angular/ui-bootstrap.min.js"></script>

    <script src="../../../../scripts/jquery/jquery-1.11.2.min.js"></script>
    -->
</head>
<body>
	<br>
	<br>
	<button onclick="requestPermissions()">Request Permissions</button><br>
	<span id="outputPR"></span><br>

	<button onclick="schedule()">Schedule</button><br>
	<span id="countDown"></span> <span id="outputS"></span><br>

	<button onclick="cancel()">Cancel</button><br>
	<span id="outputC"></span><br>

	<button onclick="cancelAll()">Cancel All</button><br>
	<span id="outputA"></span><br>

	<button onclick="getIds()">Get IDs</button><br>
	<span id="outputI"></span><br>
</body>
<script type="text/javascript">
	var intervalId, notificationId, countDown;

	//Handle notification onClick event
	buildfire.notifications.localNotification.onClick = function(data){
		alert(JSON.stringify(data));
	};

	function requestPermissions(){
		buildfire.notifications.localNotification.hasPermission(function(err, permissionsGranted){
			var message = (permissionsGranted) ? "permissions granted" : "permissions rejected";

			document.getElementById("outputPR").innerHTML = message;
		});
	}

	function schedule(){
		var secondsToWait = 10;
		countDown = secondsToWait;

		var sendTime = new Date();
		sendTime.setSeconds(sendTime.getSeconds() + secondsToWait);

		var options = {
			title: "Title Sample",
			text: "Text sample",
			data: { secret: "foo" },
			at: sendTime,
			returnToPluginInstanceId: '' //optional
		};

		buildfire.notifications.localNotification.schedule(options, function (err, data) {
			notificationId = (data.id) ? data.id : null;
			document.getElementById("outputS").innerHTML = "Scheduled notification " + notificationId;
		});

		document.getElementById("countDown").innerHTML = countDown;
		countDown = countDown - 1;

		intervalId = setInterval(function(){
			document.getElementById("countDown").innerHTML = countDown;
			countDown = countDown - 1;

			if(countDown < 0){
				clearInterval(intervalId);
			}

		}, 1000);
	}

	function getIds(){
		//TODO: Implement in API (Requires app prefix)
		cordova.plugins.notification.local.getIds(function(ids) {
			var formattedIds = ids.map(function(id){
				return id + '<br>';
			});

			document.getElementById("outputI").innerHTML = formattedIds;
		}, cordova.plugins);

	}

	function cancel(){
		buildfire.notifications.localNotification.cancel(notificationId, function(){
			document.getElementById("outputC").innerHTML = "canceled notification  " + notificationId;
		});
	}

	function cancelAll(){
		//TODO: Implement in API (Requires app prefix)
		cordova.plugins.notification.local.cancelAll(function() {
			document.getElementById("outputA").innerHTML = "canceled all";
		}, this);
	}

</script>
</html>