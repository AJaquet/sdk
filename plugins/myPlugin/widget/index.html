<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Crude cache busting -->
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />

	<!-- Load helper.css to use our helper classes.
	<link href="../../../../styles/helper.css" rel="stylesheet">
	-->
	
	<!-- JS -->
	<script src="../../../scripts/buildfire.js"></script>
	<script src="../../../scripts/buildfire/services/notifications/localNotifications.js"></script>

 	<!--
    <script src="../../../../scripts/angular/angular.min.js"></script>
    <script src="../../../../scripts/angular/ui-bootstrap.min.js"></script>

    <script src="../../../../scripts/jquery/jquery-1.11.2.min.js"></script>
    -->
</head>
<body>
	<br>
	<div>Local Notification Test Widget: 16</div><br>
	<span id="status"></span><br>
	<span id="result"></span><br>
	<span id="counter"></span><br>
	<span>cancel notification <input type="checkbox" id="cancel"></span><br>
	<br>
	<button onclick="run()">Schedule</button>
</body>
<script type="text/javascript">
	document.getElementById("status").innerHTML = "device not ready";

	var intervalId = 0;

	function run(){
		document.getElementById("status").innerHTML = "device ready";

		var counter = 0;

		clearInterval(intervalId);

		//This is just to show the passage of time
		timerId = setInterval(function () {
			document.getElementById("counter").innerHTML = counter.toString();
			counter++;
		}, 1000);

		var secondsToWait = 10;

		var sendTime = new Date();
		sendTime.setSeconds(sendTime.getSeconds() + secondsToWait);

		var options = {
			title: "Hurry",
			text: "Time is running out",
			data: { secret: "foo" },
			at: sendTime,
			returnToPluginInstanceId: ''
		};

		var notificationId;

		buildfire.notifications.localNotification.schedule(options, function (err, data) {
			document.getElementById("status").innerHTML = "schedule done";
			var result = (err) ? err : data;
			notificationId = (result.id) ? result.id : null;
			console.log('result: ', result);
			result = JSON.stringify(result);
			document.getElementById("result").innerHTML = result;

			//Check for a cancel
			setTimeout(function(){
				//Decide to cancel
				if(document.getElementById("cancel").checked){
					buildfire.notifications.localNotification.cancel(notificationId, function(){
						console.log("notification canceled");
					});
				}
			},
			2000);

		});

		buildfire.notifications.localNotification.onClick = function(data){
			alert(JSON.stringify(data));
		};

		document.getElementById("status").innerHTML = "Send called. Notification after " + secondsToWait + " seconds.";
	}

</script>
</html>