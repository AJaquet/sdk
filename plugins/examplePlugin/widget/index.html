<!DOCTYPE html>
<html ng-App="textPlugin">
<head lang="en">
    <meta charset="UTF-8">
    <title>example Text widget</title>

    <script src="../../../scripts/angular/angular.min.js"></script>
    <script type="text/javascript" src="../../../scripts/buildfire.js"></script>

    <style>
        .style1{
            border: 5px solid red;
        }

        .style2{
            border: 5px solid blue;
        }
    </style>
</head>
<body>
<div ng-controller="textPluginCtrl" ng-cloak style="background:url( {{data.content.bgURL}} )" class="{{data.design.style}}" >
    {{data.content.text}}
    <hr/>
    <i ng-show="data.content.approvedOn">Approved on:{{data.content.approvedOn}}</i>
</div>

<script>

    var textPluginApp = angular.module('textPlugin', []);

    textPluginApp.controller('textPluginCtrl', ['$scope', function ($scope) {

        /*
        * bind data to scope
        * */
        function bind(data){
            $scope.data = data;
            $scope.$digest();
        }

        /*
         * Go pull saved data
         * */
        function loadData() {
            buildfire.datastore.get(function (err, result) {
                if (result) bind(result.data);
            });
        }
        loadData();

        /**
         * when a refresh is triggered get reload data
         */
        buildfire.datastore.onRefresh(loadData);
        //buildfire.datastore.disableRefresh(); // to turn off refresh feature

        /*
         Listen in if an update occurred on the control panel
         */
        buildfire.datastore.onUpdate(function (e) {
            loadData(e.obj);
        });

        /*
        * track every time this widget is opened
        * */
        buildfire.analytics.trackAction('widget loaded',{userid:2});
    }]);
</script>

</body>
</html>