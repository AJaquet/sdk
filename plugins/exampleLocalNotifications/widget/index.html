<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- JS -->
	<script src="../../../scripts/buildfire.js"></script>
	<script src="../../../scripts/buildfire/services/notifications/localNotifications.js"></script>

</head>
<body>
	<br>
	<br>
	<button onclick="requestPermissions()">Request Permissions</button><br>
	<span id="outputPR"></span><br>

	<button onclick="schedule()">Schedule</button><br>
	<span id="countDown"></span> <span id="outputS"></span><br>

	<button onclick="cancel()">Cancel</button><br>
	<span id="outputC"></span><br>
</body>
<script type="text/javascript">
	var intervalId, notificationId, countDown;

	function requestPermissions(){
		buildfire.notifications.localNotification.hasPermission(function(err, permissionsGranted){
			var message = (permissionsGranted) ? "permissions granted" : "permissions rejected";

			document.getElementById("outputPR").innerHTML = message;
		});
	}

	function schedule(){
		var secondsToWait = 10;
		countDown = secondsToWait;

		var sendTime = new Date();
		sendTime.setSeconds(sendTime.getSeconds() + secondsToWait);

		var options = {
			title: "Title Sample",
			text: "Text sample",
			data: { secret: "foo" },
			at: sendTime,
			returnToPluginInstanceId: '' //optional
		};

		buildfire.notifications.localNotification.schedule(options, function (err, data) {
			notificationId = (data.id) ? data.id : null;
			var notificationIdDisplay = notificationId || "";

			document.getElementById("outputS").innerHTML = "Scheduled notification " + notificationIdDisplay;
		});

		document.getElementById("countDown").innerHTML = countDown;
		countDown = countDown - 1;

		intervalId = setInterval(function(){
			document.getElementById("countDown").innerHTML = countDown;
			countDown = countDown - 1;

			if(countDown < 0){
				clearInterval(intervalId);
			}

		}, 1000);
	}

	function cancel(){
		buildfire.notifications.localNotification.cancel(notificationId, function(){
			document.getElementById("outputC").innerHTML = "canceled notification  " + notificationId;
		});
	}

	//Handle notification onClick event
	buildfire.notifications.localNotification.onClick = function(data){
		alert(JSON.stringify(data));
	};

</script>
</html>